name: penn-marketplace

services:
  backend:
    build:
      context: .
      dockerfile: .devcontainer/Dockerfile
      target: dev
    volumes:
      - .:/workspace:cached
      - ./backend:/app:cached
      - backend-venv:/app/.venv
      - pnpm-store:/root/.local/share/pnpm
      - /app/__pycache__
    command: sleep infinity
    environment:
      - PYTHONUNBUFFERED=1
      - DJANGO_SETTINGS_MODULE=config.settings.development
      - DATABASE_URL=postgres://postgres:postgres@db:5432/penn_marketplace
      - REDIS_URL=redis://redis:6379/0

  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
      target: dev
    volumes:
      - ./frontend:/app:cached
      - frontend-node-modules:/app/node_modules
      - frontend-next:/app/.next
    command: pnpm dev
    environment:
      - NODE_ENV=development
      - NEXT_PUBLIC_API_URL=http://localhost:8000
      - WATCHPACK_POLLING=true

volumes:
  backend-venv:
  frontend-node-modules:
  frontend-next:
  pnpm-store:

